---
title   : Interceptor ë‚˜ Argument Resolver ì—ì„œ memberë¥¼ ì¡°íšŒí•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•´ì£¼ë©´ ì•ˆ ë˜ë‚˜?
date    : 2023-08-16 10:01:48 +0900
updated : 2023-08-16 10:01:54 +0900
tags     : 
- spring
- interceptor
- argument-resolver
- shook
- ë ˆë²¨3
- ìš°í…Œì½”
---

## ìƒí™© ì„¤ëª…

S-HOOK ì€ ë¡œê·¸ì¸ ëœ íšŒì›ë§Œ íˆ¬í‘œ, ì¢‹ì•„ìš”, ëŒ“ê¸€ í™œë™ì„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.     
ê·¸ëŸ¬ë ¤ë©´ ì¸ì¦/ì¸ê°€ ë¡œì§ì´ í•„ìˆ˜ì ìœ¼ë¡œ í•„ìš”í•©ë‹ˆë‹¤. í•´ë‹¹ ì‚¬ìš©ìê°€ ìš°ë¦¬ íšŒì›ì¸ì§€ í™•ì¸í•˜ê³ , íšŒì›ì¸ ê²½ìš°ì—ë§Œ íˆ¬í‘œ / ì¢‹ì•„ìš” / ëŒ“ê¸€ ê¸°ëŠ¥ì„ ì“¸ ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì´ì£ .      

ì´ë¥¼ ìœ„í•´ OAuth + JWT ì¸ì¦ ë¡œì§ì„ ë„ì…í–ˆëŠ”ë°ìš”, JWT ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ë¡œ ì „ë‹¬ë˜ëŠ” ê°’ì€ íšŒì›ì˜ id ê°’ì…ë‹ˆë‹¤.      

í˜„ì¬ s-hook ì˜ ì½”ë“œì—ì„œëŠ” interceptor ë‹¨ì—ì„œ ë”°ë¡œ idë¥¼ í†µí•´ member ê°€ ì¡´ì¬í•˜ëŠ”ì§€ ì¡°íšŒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. í† í°ì´ ìœ íš¨í•˜ê¸°ë§Œ í•œë‹¤ë©´ ê·¸ëŒ€ë¡œ íŒŒì‹±ëœ id ë¥¼ argument resolver ë¡œ ì „ë‹¬í•˜ëŠ” ë¡œì§ì…ë‹ˆë‹¤.     

ì´ëŸ° ì¸ì¦ ê³¼ì •ì— ëŒ€í•´ ë“¤ì—ˆë˜ ê°œì¸ì ì¸ ì˜ë¬¸ê³¼ ì´ì— ë‹µí•  ìˆ˜ ìˆëŠ” ì—¬ëŸ¬ ì˜ê²¬ë“¤ì„ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤.

## ì˜ë¬¸ì´ ë“¤ì—ˆë˜ ë¶€ë¶„ë“¤

### íšŒì›ì˜ id ë¥¼ interceptor ì—ì„œ ê²€ì¦í•˜ì§€ ì•Šì•„ë„ ë ê¹Œ?

ê°€ì¥ ë¨¼ì € ì˜ë¬¸ì´ ë“¤ì—ˆë˜ ë¶€ë¶„ì€ `JWT ë‚´ë¶€ì— ë“¤ì–´ìˆëŠ” íšŒì›ì˜ id ê°’ì„ ê²€ì¦í•˜ì§€ ì•Šì•„ë„ ë ê¹Œ?`  ë¼ëŠ” ê²ƒì…ë‹ˆë‹¤.     

í† í° ë‚´ë¶€ì— ìˆëŠ” id ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” member ë¼ë©´ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ë„ ìˆì§€ ì•Šì„ê¹Œìš”? 
#### JWT

ê²°ë¡ ë§Œ ë§í•˜ìë©´, ì €í¬ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” JWT ì—ì„œëŠ” í† í° ë‚´ë¶€ì— ìˆëŠ” ê°’ì„ ê²€ì¦í•  'í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤'

ê·¸ ì´ìœ ëŠ” JWT ì˜ ëª©ì ì— ìˆìŠµë‹ˆë‹¤.     

JWT ëŠ” ë°ì´í„°ë¥¼ ì•”í˜¸í™”í•˜ê¸° ìœ„í•¨ì´ ì•„ë‹Œ, ë°ì´í„°ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ëª©ì ìœ¼ë¡œ ì„¤ê³„ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¦‰, ë°ì´í„°ê°€ ë³€ì¡°ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ê²ƒë§Œì„ í™•ì¸í•˜ê¸° ìœ„í•œ ê²ƒì…ë‹ˆë‹¤.     

ë˜í•œ JWT ëŠ” ì‚¬ìš©ì ì¸ì¦ í›„ì— 'ì„œë²„' ë¡œë¶€í„° ë°œê¸‰ë°›ëŠ” ê²ƒì´ë¯€ë¡œ, í† í°ì´ ë°œê¸‰ë˜ëŠ” ì‹œì ì—ì„œ ì‚¬ìš©ìëŠ” ì´ë¯¸ ê²€ì¦ë˜ì—ˆë‹¤ê³  ê°„ì£¼í•©ë‹ˆë‹¤.    

ë”°ë¼ì„œ í† í°ì´ ìœ íš¨í•˜ê³ , ë³€ì¡°ë˜ì§€ ì•Šì•˜ê³ , í† í°ì´ ë§Œë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´ í† í° ë‚´ë¶€ì˜ ë°ì´í„°ëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¬¼ë¡  JWT ë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ secret key ëŠ” ë°˜ë“œì‹œ ì™¸ë¶€ì— ë…¸ì¶œë˜ì§€ ì•Šì•˜ì–´ì•¼ í•˜ê² ì§€ìš”.

#### JWT ì¸ì¦ ê³¼ì •

JWT ì˜ ì¸ì¦ì„ ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.     

1. í† í°ì˜ ì„œëª… í™•ì¸
2. ìœ íš¨ ê¸°ê°„ í™•ì¸
3. í† í° ë°œê¸‰ì í™•ì¸
4. í† í° ìˆ˜ì‹ ì í™•ì¸
5. í† í° ê³ ìœ  ì‹ë³„ì í™•ì¸

ì´ëŸ° ì¸ì¦ ê³¼ì •ì„ ëª¨ë‘ í†µê³¼í•œ JWT ëŠ” ìš°ë¦¬ ì„œë²„ì—ì„œ ë°œê¸‰í•œ í† í°ì´ë¼ê³  ê°„ì£¼ë˜ì–´, ë‚´ë¶€ì˜ ë°ì´í„°ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

ë¬´ì—‡ë³´ë‹¤ JWT ë¥¼ ì‚¬ìš©í•˜ëŠ” ì£¼ëœ ì´ìœ ëŠ” ì¸ì¦ í›„ì— ì‚¬ìš©ìì˜ ìƒíƒœë‚˜ ì„¸ì…˜ ì •ë³´ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³ , ì„œë²„ì—ì„œ stateless í•˜ê²Œ ì‹œìŠ¤í…œì„ ìš´ì˜í•˜ê¸° ìœ„í•´ì„œì…ë‹ˆë‹¤. 

ì¦‰, ë§¤ ìš”ì²­ë§ˆë‹¤ ì‚¬ìš©ìì˜ ID ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê²€ì¦í•˜ëŠ” ê²ƒì„ í”¼í•˜ê¸° ìœ„í•´ JWT ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ì£ .

### ì‚¬ìš©ìì˜ ID ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ ì•„ë‹ê¹Œ?

JWT ë¥¼ ìƒì„±í•  ë•Œ ì¤‘ìš”í•˜ê²Œ ê³ ë ¤í•´ì•¼ í•˜ëŠ” ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤. JWT ëŠ” ì•”í˜¸í™”ë¥¼ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ë‚´ë¶€ì˜ ë°ì´í„°ê°€ ë¯¼ê°í•œ ì •ë³´ì¸ ê²½ìš°, ë¶ˆíŠ¹ì • ë‹¤ìˆ˜ì—ê²Œ ì •ë³´ê°€ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.    

ê·¸ëŸ¬ë¯€ë¡œ S-HOOK ì„œë²„ì—ì„œ ë°œí–‰í•œ JWT ë‚´ë¶€ì— ë“¤ì–´ê°€ëŠ” ì‚¬ìš©ìì˜ ID ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ ì•„ë‹ˆì–´ì•¼ í•©ë‹ˆë‹¤.     

ê·¸ë ‡ë‹¤ë©´ ì‚¬ìš©ì ID ëŠ” ë¯¼ê°í•œ ì •ë³´ê°€ ì•„ë‹ê¹Œìš”?
ë§ˆì°¬ê°€ì§€ë¡œ 'ì €í¬ ì„œë¹„ìŠ¤ì—ì„œëŠ”' YES ì…ë‹ˆë‹¤.    

S-HOOK ì€ ì‚¬ìš©ì ID ë§Œìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ìš”ì²­ì€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ID ë¥¼ ê°€ì§€ê³  ì„œë²„ ì‹œìŠ¤í…œ ë‚´ë¶€ë¥¼ ì¡°ì‘í•˜ê±°ë‚˜ íŠ¹ì • í–‰ë™ì„ ìˆ˜í–‰í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.     

ë˜í•œ ëŒ€ê°œì˜ ê²½ìš°, ì‚¬ìš©ì ID ëŠ” ë¯¼ê°í•œ ì •ë³´ë¡œ ê°„ì£¼ë˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤. ì‚¬ìš©ì ID ë¥¼ JWT í˜ì´ë¡œë“œì— í¬í•¨í•˜ëŠ” ê²ƒì´ ê´€í–‰ì¼ ë§Œí¼ ë§ì´ì£ .     

### ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ì— Member ê°ì²´ë¥¼ ë„˜ê²¨ì£¼ë©´ ì•ˆ ë ê¹Œ?

JWT ë‚´ë¶€ì˜ ID ë¥¼ ê²€ì¦í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ê±´ ì´ì œ ì•Œê² ìŠµë‹ˆë‹¤.     

ê·¸ë ‡ë‹¤ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ë¡œ Member id ë¥¼ ì „ë‹¬í•˜ëŠ” ëŒ€ì‹ , Member ë¥¼ ë§Œë“¤ì–´ì„œ ë³´ë‚´ì£¼ë©´ ì•ˆ ë˜ëŠ” ê±¸ê¹Œìš”?     

í˜„ì¬ ì¸ì¦ ë¡œì§ì—ì„œëŠ” Member ê°€ í•„ìš”í•œ ê° ì„œë¹„ìŠ¤ë§ˆë‹¤ `MemberService` ë¥¼ ì£¼ì… ë°›ì•„ id ë¡œ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘ë³µ ì½”ë“œê°€ ì¡´ì¬í•©ë‹ˆë‹¤. Interceptor ë‚˜ Argument Resolver ê°€ ëŒ€ì‹  `MemberService` ë¥¼ ì£¼ì… ë°›ì•„ì„œ Member ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤ë©´ ì¤‘ë³µ ì½”ë“œë„ ì—†ì–´ì§€ê³  ì¢‹ì§€ ì•Šì„ê¹Œìš”?

#### ê³„ì¸µì  ê´€ì ìœ¼ë¡œ ë³´ì•˜ì„ ë•Œ ê´œì°®ì„ê¹Œ?

ë¨¼ì € ê³„ì¸µì  ê´€ì ì—ì„œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.     
Interceptor ì™€ Argument Resolver ì—ì„œ Member ë¥¼ ì¡°íšŒí•´ë„ 'ê´œì°®ì€ ê±¸ê¹Œìš”'?

S-HOOK ì˜ ì½”ë“œëŠ” Layered Architecture ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.     

ê³„ì¸µì  êµ¬ì¡°ë¥¼ ë”°ë¥´ë©´ ê° ê³„ì¸µë§ˆë‹¤ ëª…í™•í•œ ì±…ì„ì„ ê°€ì§€ê³  ìˆì–´ì„œ, ê¸°ëŠ¥ê³¼ ì—­í• ì„ ë” ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.    
ë˜í•œ ê° ê³„ì¸µì„ ë…ë¦½ì ìœ¼ë¡œ ê°œë°œ / í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆì–´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•©ë‹ˆë‹¤.    
íŠ¹íˆ íŠ¹ì • ê³„ì¸µì˜ êµ¬í˜„ì´ ë³€ê²½ë˜ì–´ë„ ë‹¤ë¥¸ ê³„ì¸µì— ë¹„êµì  ì ì€ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìœ ì§€ë³´ìˆ˜ì™€ í™•ì¥ì„±ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

ê·¸ë ‡ë‹¤ë©´ Argument Resolver / Interceptor ì—ì„œ Member ë¥¼ ì¡°íšŒí•˜ë©´ ê³„ì¸µì  êµ¬ì¡°ë¥¼ ìœ„ë°˜í•´ì„œ ë¬¸ì œê°€ ë°œìƒí• ê¹Œìš”?     

ì—„ë°€íˆ ë§í•˜ë©´ ê³„ì¸µì  êµ¬ì¡°ë¥¼ ìœ„ë°˜í•œë‹¤ê³ ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. Interceptor ì™€ Argument Resolver ëŠ” Web Layer ì— ì†í•œë‹¤ê³  ìƒê°í•œë‹¤ë©´, Application Layer ì— ì†í•˜ëŠ” `MemberService` ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì€ Presentation Layer ë¥¼ ê±°ì¹˜ì§€ ì•Šì•„ ê·œì¹™ì„ ìœ„ë°˜í•œ ê²ƒì´ê¸° ë•Œë¬¸ì´ì£ .

ê·¸ëŸ¬ë‚˜ ì‹¤ìš©ì ìœ¼ë¡œ ìƒê°í–ˆì„ ë•Œ, íš¡ë‹¨ ê´€ì‹¬ì‚¬ì¸ `Member` ì˜ ì¡°íšŒë¥¼ Interceptor ë‚˜ Argument Resolver ì—ì„œ ìˆ˜í–‰í•˜ëŠ” ê²ƒì€ íš¨ìœ¨ì ì´ê³  í¸ë¦¬í•œ ì ‘ê·¼ ë°©ì‹ì…ë‹ˆë‹¤.      

ë‹¤ë§Œ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì œì ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì€ ì¸ì§€í•´ì•¼ í•©ë‹ˆë‹¤.     

1. í…ŒìŠ¤íŠ¸ê°€ ë³µì¡í•˜ë‹¤.
ë„ë©”ì¸ ê°ì²´ê°€ Argument Resolver / Interceptor ë¥¼ í†µí•´ ì „ë‹¬ë˜ëŠ” ê²½ìš°, ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ì½”ë“œê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

2. ì½”ë“œì˜ ìœ ì—°ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤.
ë„ë©”ì¸ ê°ì²´ì˜ ì¡°íšŒ ë¡œì§ì´ë‚˜ ìƒì„± ë°©ì‹ì´ ë³€ê²½ë˜ëŠ” ê²½ìš° Argument Resolver / Interceptor ë¡œ ì˜í–¥ì´ ì „íŒŒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¬¸ì œì ì„ ì¶©ë¶„íˆ ì´í•´í–ˆê³  ê°ì•ˆí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ë¼ê³  ìƒê°ëœë‹¤ë©´, ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°€ ë´…ì‹œë‹¤!

#### ë„ë©”ì¸ ê°ì²´ê°€ Presentation ê³„ì¸µì— ë…¸ì¶œë˜ì—ˆì„ ë•Œ ë¬¸ì œì ì€ ì—†ì„ê¹Œ?

Argument Resolver ë‚˜ Interceptor ì—ì„œ Member ë¥¼ ì¡°íšŒí•œë‹¤ë©´, ì»¨íŠ¸ë¡¤ëŸ¬ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ë¡œ Member ê°ì²´ê°€ ì „ë‹¬ë©ë‹ˆë‹¤.     
ì´ë¡œì¨ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ í¬í•¨ëœ ë„ë©”ì¸ ê°ì²´ê°€ Presentation ê³„ì¸µì— ë…¸ì¶œë˜ì—ˆë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ´ ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì ì€ ì—†ì„ê¹Œìš”?

**ë¬¸ì œì **

1. ë„ë©”ì¸ê³¼ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ê²°í•©ë„ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
ë„ë©”ì¸ ê°ì²´ì— ë³€ê²½ì´ ë°œìƒí•œ ê²½ìš°, Presentation Layer ì—ë„ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì‹œìŠ¤í…œì˜ ê²°í•©ë„ê°€ ë†’ì•„ì§„ë‹¤ê³  ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ íë¦„ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ì„œë¹„ìŠ¤ê°€ ì§ì ‘ì ìœ¼ë¡œ ì¸ì¦ / ì¸ê°€ ë¡œì§ì„ í¬í•¨í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì—, í”„ë¡œì íŠ¸ íŒ€ì›ì´ ì•„ë‹Œ ì‚¬ëŒì´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì „ì²´ íë¦„ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

ê·¸ëŸ¬ë‚˜ í˜„ì¬ ì €í¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ë‹¨ìˆœíˆ ID ë¡œ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ë¡œì§ë§Œ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì—, ì•„ì§ê¹Œì§€ ìœ„ì˜ ë¬¸ì œì ì´ í¬ê²Œ ë¬¸ì œê°€ ë˜ëŠ” ë¶€ë¶„ì€ ì—†ì„ ë“¯ í•©ë‹ˆë‹¤. (í”„ë¡œì íŠ¸ë¥¼ í•¨ê»˜ ì§„í–‰í•˜ê³  ìˆëŠ” íŒ€ì´ ê³„ì¸µê°„ì˜ ë¶„ë¦¬ë¥¼ ì¤‘ì‹œí•œë‹¤ë©´ ë‹¤ë¥¸ íŒë‹¨ì„ ë‚´ë¦´ ìˆ˜ë„ ìˆì„ ê²ƒì…ë‹ˆë‹¤)

### Interceptor vs Argument Resolver

ê·¸ë ‡ë‹¤ë©´ Interceptor ë˜ëŠ” Argument Resolver ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ì§€ ì•Šì„ê¹Œ? ë¼ê³  ìƒê°í•˜ì…¨ì„ ê²ë‹ˆë‹¤.
ê·¸ë ‡ë‹¤ë©´ ë‘˜ ì¤‘ ì–´ë””ì—ì„œ `MemberService` ë¥¼ ì‚¬ìš©í•˜ì—¬ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œìš”?

#### Member ë¥¼ interceptor ì—ì„œ ì¡°íšŒí•˜ì

Interceptor ëŠ” ìš”ì²­ì˜ ì „ì²˜ë¦¬ / í›„ì²˜ë¦¬ì™€ ìš”ì²­ / ì‘ë‹µì˜ ë³€ê²½, ë¡œê¹…, ì¸ì¦ê³¼ ê¶Œí•œ ì²´í¬ ê°™ì€ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ë˜í•œ ì—¬ëŸ¬ ì»¨íŠ¸ë¡¤ëŸ¬ì— ëŒ€í•´ ë™ì¼í•œ ë¡œì§ì„ ì ìš©í•˜ê³  ì‹¶ì„ ë•Œ íš¨ê³¼ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.     

ê·¸ëŸ¬ë‚˜ Interceptor ì—ì„œ idë¡œ ë¶€í„° Member ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì€ Interceptor ê°€ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ì¼ì„ ë„˜ì–´ì„°ë‹¤ê³ ë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.    
id ê°’ìœ¼ë¡œë¶€í„° Member ë¥¼ ì¡°íšŒí•˜ì—¬ ì „ë‹¬í•˜ëŠ” ê²ƒì€ 'ìš”ì²­ê³¼ ì‘ë‹µì„ ê°€ê³µ' í•˜ëŠ” ê²ƒê³¼ëŠ” ê±°ë¦¬ê°€ ë©€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.     

ë˜í•œ Interceptor ëŠ” ìš”ì²­ì˜ ìƒëª… ì£¼ê¸° ë‚´ì—ì„œ `preHandle`, `postHandle`, `afterCompletion` ì—ì„œ ë™ì‘í•˜ë¯€ë¡œ, íŒŒë¼ë¯¸í„°ë¥¼ ë³€í™˜í•˜ëŠ” ë°ì— ì í•©í•œ ìƒëª…ì£¼ê¸°ë¥¼ ê°–ê³  ìˆë‹¤ê³  ë§í•˜ê¸° ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë³€í™˜ë  Member ëŠ” ìš”ì²­ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ ì•„ë‹Œ, ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì–´ Service ë¡œ ë„˜ê²¨ì§€ê¸° ìœ„í•´ì„œ ì‚¬ìš©ë˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

ê·¸ëŸ¬ë¯€ë¡œ Interceptor ì—ì„œëŠ” JWT ì˜ ìœ íš¨ì„± ê²€ì‚¬ë‚˜ ê¶Œí•œì„ ì²´í¬í•˜ëŠ” ë“±, ì¸ì¦ / ì¸ê°€ì™€ ê´€ë ¨ëœ ë¡œì§ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ë” ì í•©í•˜ë‹¤ê³  í•  ìˆ˜ ìˆê² ìŠµë‹ˆë‹¤.

#### Member ë¥¼ Argument Resolver ì—ì„œ ì¡°íšŒí•˜ì

Argument Resolver ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê±°ë‚˜ ë³€í™˜í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•  ë•Œ ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.    

JWT ë¡œë¶€í„° ì–»ì€ ì‚¬ìš©ìì˜ ID ë¥¼ Member ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì€ Argument Resolver ê°€ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ì–´ìƒ‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### JPAë¥¼ ì‚¬ìš©í•  ë•Œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì 

> ì˜¤ ê·¸ëŸ¬ë©´ Argument Resolver ì—ì„œ Member ì¡°íšŒí•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•´ì•¼ê² ë‹¤ ğŸ˜„

ê·¸ëŸ¬ë‚˜ ì´ ê¸€ì„ ì½ê³  ê³„ì‹œëŠ” ë¶„ì´ í”„ë¡œì íŠ¸ì—ì„œ JPA ë¥¼ ì‚¬ìš©í•˜ì‹ ë‹¤ë©´ ë°˜ë“œì‹œ ê³ ë ¤í•˜ì…”ì•¼ í•˜ëŠ” ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.     

**OSIV**

OSIV ëŠ” Open Session In View ì˜ ì•½ìë¡œ, JPA ì˜ Session ì´ë‚˜ Hibernate ì˜ SessionFactory ê°€ HTTP ìš”ì²­ì˜ ì‹œì‘ë¶€í„° ì¢…ë£Œê¹Œì§€ ì—´ë¦° ìƒíƒœë¡œ ìœ ì§€ë˜ê²Œ í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤.     
Spring ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ê°€ ë˜ì–´ ìˆì§€ë§Œ, í•˜ë‚˜ì˜ ì„¸ì…˜ ì•ˆì˜ íŠ¸ëœì­ì…˜ë“¤ì´ ë™ì¼í•œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³µìœ í•˜ê¸° ë•Œë¬¸ì— ì£¼ì˜ë¥¼ ìš”í•©ë‹ˆë‹¤.      

(OSIV ì— ëŒ€í•´ì„œëŠ” ì¶”í›„ ê¸€ì„ ìì„¸í•˜ê²Œ ì ì–´ë³´ê² ìŠµë‹ˆë‹¤.)

Argument Resolver ì—ì„œ ì£¼ì˜í•´ì•¼ í•˜ëŠ” ê²½ìš°ëŠ” **OSIV ì„¤ì •ì´ êº¼ì ¸ìˆì„ ë•Œ** ì…ë‹ˆë‹¤.     

ë‹¤ìŒê³¼ ê°™ì´ yaml íŒŒì¼ì—ì„œ OSIV ì„¤ì •ì„ êº¼ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```yaml
spring:
	jpa:
		open-in-view: false
```

Argument Resolver ê°€ `MemberService` ë¡œ Member ë¥¼ ì¡°íšŒí•œë‹¤ê³  í•´ë´…ì‹œë‹¤.

```java
@Component  
public class AuthArgumentResolver implements HandlerMethodArgumentResolver {  
  
    private final AuthContext authContext;  
    private final MemberService memberService;  
  
    public AuthArgumentResolver(final AuthContext authContext, final MemberService memberService) {  
        this.authContext = authContext;  
        this.memberService = memberService;  
    }  
  
    @Override  
    public boolean supportsParameter(final MethodParameter parameter) {  
		return parameter.hasParameterAnnotation(Authenticated.class);  
    }  
  
    @Override  
    public Object resolveArgument(  
        final MethodParameter parameter,  
        final ModelAndViewContainer mavContainer,  
        final NativeWebRequest webRequest,  
        final WebDataBinderFactory binderFactory  
    ) {  
        return memberService.findById(authContext.getMemberId());  
    }  
}
```

ì‹¤í—˜ì„ ìœ„í•´ ê¸°ì¡´ì— Argument Resolver ë¡œë¶€í„° Member ì˜ ID ë¥¼ ì „ë‹¬ë°›ë˜ `KillingPartLikeController` ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.     

```java
public class KillingPartLikeController {  
  
    private final KillingPartLikeService killingPartLikeService;  
  
    @PutMapping  
    public ResponseEntity<Void> createLikeOnKillingPart(  
        @PathVariable(name = "killing_part_id") final Long killingPartId,  
        @Valid @RequestBody final KillingPartLikeRequest request,  
        @Authenticated final Member member  
    ) {  
        killingPartLikeService.updateLikeStatus(killingPartId, member, request);  
  
        return ResponseEntity.status(HttpStatus.CREATED).build();  
    }  
}
```

`KillingPartCommentService` ì—ì„œëŠ” `EntityManager` ë¥¼ ê°€ì ¸ì™€ì„œ Member ê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ê² ìŠµë‹ˆë‹¤.     

```java
@Transactional(readOnly = true)  
@Service  
public class KillingPartLikeService {  
  
    private final KillingPartRepository killingPartRepository;  
    private final MemberRepository memberRepository;  
    private final KillingPartLikeRepository likeRepository;  
  
    @Autowired  
    private EntityManager entityManager;  
  
    @Transactional  
    public void updateLikeStatus(  
        final Long killingPartId,  
        final Member member,  
        final KillingPartLikeRequest request  
    ) {  
        System.out.println("====================Member ê°€ ì¡´ì¬í• ê¹Œ====================");  
        System.out.println(entityManager.contains(member));  
        System.out.println("====================ê²°ê³¼ ì¶œë ¥ ì™„ë£Œ====================");  
        
        ...
    }
```

ì´ë ‡ê²Œ ì„¤ì •í•´ë‘ê³ , ì‹¤ì œ ìš”ì²­ì„ ë³´ë‚´ê²Œ ë˜ë©´ `MemberService` ì—ì„œ ì—´ë¦° ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ëŠ” Argument Resolver ì—ì„œ ì¡°íšŒí•œ Member ê°€ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.    

![[entity-manager-cannot-find-member.png]]

ì™œ ì´ëŸ° ì¼ì´ ë°œìƒí–ˆì„ê¹Œìš”?     

Argument Resolver ì—ì„œ Member ë¥¼ ì¡°íšŒí•œ í›„ì— ì»¨íŠ¸ë¡¤ëŸ¬ì— ì „ë‹¬í•©ë‹ˆë‹¤. ê·¸ëŸ°ë° `MemberService` ì˜ íŠ¸ëœì­ì…˜ì´ ë‹«íˆë©´ì„œ ì¡°íšŒí•œ Member ëŠ” ì¤€ì˜ì† ìƒíƒœê°€ ë©ë‹ˆë‹¤.     
ì¤€ì˜ì† ìƒíƒœì¸ ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— í¬í•¨ë˜ê¸° ìœ„í•´ì„œëŠ” DB ì—ì„œ Member ë¥¼ ë‹¤ì‹œ ì¡°íšŒí•´ì•¼ í•©ë‹ˆë‹¤.      

ê²°êµ­ Serviceì˜ ë©”ì„œë“œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœ Member ì— ë³€ê²½ì´ ë°œìƒí–ˆì–´ë„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ëŠ” ë³€ê²½ ê°ì§€ë¥¼ í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.     

í˜„ì¬ ì €í¬ ì„œë¹„ìŠ¤ì—ì„œëŠ” Member ê°€ ë³€ê²½ë˜ëŠ” ì¼ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì¶”í›„ OSIV ì„¤ì •ì„ êº¼ ë‘” ìƒíƒœì—ì„œ Member ì— ë³€ê²½ì´ ë°œìƒí•˜ëŠ” ê²½ìš° ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ê¸° í˜ë“¤ ê²ƒì…ë‹ˆë‹¤.      

ë”°ë¼ì„œ JPA ë¥¼ ì‚¬ìš©í•˜ê³  OSIV ì„¤ì •ì„ êº¼ë‘ì—ˆì„ ê²½ìš°, Argument Resolver ë‚˜ Interceptor ì—ì„œ Member ë¥¼ ì¡°íšŒí•´ì„œ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•  ë•Œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.     

## ê²°ë¡ 

> ê·¸ë˜ì„œ ë­ ì–´ë–»ê²Œ í•˜ë©´ ì¢‹ë‹¤ëŠ” ê±°ì•¼ ğŸ¤·ğŸ»â€â™‚ï¸

ë¼ëŠ” ìƒê°ì´ ë“œì‹¤ì§€ë„ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.      

ì œ ë‚˜ë¦„ì˜ ê²°ë¡ ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

- JWT ë¥¼ ì‚¬ìš©í•  ë•Œ í† í° ë‚´ë¶€ì˜ ê°’ì„ ê²€ì¦í•  í•„ìš”ëŠ” ì—†ë‹¤.
- Argument Resolver ì™€ Interceptor ì¤‘ì—ì„œëŠ” Argument Resolver ì—ì„œ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ë‚«ë‹¤.
- OSIV ì„¤ì •ì´ êº¼ì ¸ ìˆê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìƒì—ì„œ Member ì˜ ë³€ê²½ì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìˆëŠ” ê²½ìš° ì˜¤íˆë ¤ ì¤€ì˜ì† ìƒíƒœì˜ Member ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•œ ì¿¼ë¦¬ê°€ ì¶”ê°€ë¡œ ë°œìƒí•˜ë¯€ë¡œ, ì¤‘ë³µ ì½”ë“œê°€ ë°œìƒí•˜ë”ë¼ë„ Service ì—ì„œ Member ë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì¢‹ì•„ë³´ì¸ë‹¤.

ì œ ê²°ë¡ ì´ ì •ë‹µì€ ì•„ë‹ˆê³  ë‹¤ì–‘í•œ ìƒí™©ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìƒí™©ì— ë§ê²Œ ì‚¬ìš©í•˜ì‹œë©´ ì¢‹ê² ìŠµë‹ˆë‹¤.