---
title   : 오리와 페어 6/8
date    : 2023-06-08 20:37:26 +0900
updated : 2023-06-08 20:37:40 +0900
tags     : 
- matzip
- 우테코
---

## 우테코 미션
- 2레벨, 3레벨, 4레벨
	- ec2를 그냥 제공해준다.
	- 클라우드 환경을 구축하는 일이 없다. ec2를 구축하는 일이 없다. vpc도 그냥 시키는 대로...
	- ec2를 사용하는 것은 쓴다고 하기 좀 애매하다.
	- vpc를 실제로 세팅하고, 내부 인스턴스들을 관리를 직접 해보는 것이 중요하다.
	- 네트워크를 학습하는데 도움이 된다. (vpc, subnet mask, bastin, ...)
	- 그러니 그냥 제공받는 거 쓰지 말고 vpc 세팅을 한 번 해보자!
- 물론 데브옵스를 할 건 아니지만 vpc endpoint는 직접 구축해 보는 게 좋다.

- 참고 링크 : https://tech.cloud.nongshim.co.kr/2023/03/16/%ec%86%8c%ea%b0%9c-vpc-endpoint%eb%9e%80/
## matzip 환경
- 환경은 총 3개가 될 것이다. (또는 운영+모니터링, 베타 2개)
	- 운영이 실제 띄워지는 환경
	- 베타가 띄워지는 환경
		- develop, staging 환경
		- 우테코에서 미션할 때는 로컬에서 개발하고 테스트 한 후에 운영에 배포한다. 그러나 운영이나 로컬이나 비슷한 환경을 맞춰도 100% 된다는 보장이 없다.
		- 최대한 운영에 비슷한 환경 -> 베타에 먼저 배포하고 QA를 실행하고 운영에 배포하는 경우가 많다.
	- 모니터링 환경: 그라파나 (모니터링 데이터를 UI로 가시화 하는 것) -> 운영으로 합쳐질 수도 있다.
		- CPU, Memory 수치를 보면서 ec2에 과부하가 오는지 아닌지를 파악하기 위함. 
		- 요청수를 보면서 트래픽이 얼마나 들어오는지를 파악하기 위함.

### 해야 할 것
- VPC 세팅 `CIDER: 10.0.0.0/16` (관습적으로 이렇게 쓴다는데 이유도 알아보자 -> reserved ip 피해서?)
- public subnet, private subent을 구성해야 한다. subnet은 2개로 구성해야 한다. (public도 가용영역마다 2개씩 - 2a, 2c에 하나씩 이런 식으로)
	- 운영 환경에 대한 라우팅 테이블(rt) 을 구축한다(지정한다).
		- 하나의 vpc 환경이 있을 때 subnet mask를 운영 환경으로 잡고 여기에 대한 라우팅 테이블을 설정한다.
	- (후순위) 베타 환경에 대한 라우팅 테이블(rt) 을 구축한다(지정한다).
- ec2, s3, rds의 주소는 모두 private으로 한다.
	- db를 private으로 막는 이유는 직접 접근을 못하게 하기 위함.
	- application도 직접 접근을 막아야 한다.
	- 외부의 요청을 받아야 한다. -> Internet Gateway (IGW)를 사용할 것
	- IGW(public) -> Routing table(public) -> ec2(private)
- 운영과 베타의 vpc를 다르게 둘 것인가에 대한 고민
	- 베타는 막쓰는 서버이고, 운영은 중요한 정보가 있기 때문에 베타에서 운영을 접근할 수 있게 해서는 안 된다.
	- 같이 두면 편하다. -> 모니터링 환경이 있는데, peering을 해야 한다.
	- 모니터링 환경도 vpc를 다르게 둔다고 했을 때, 모니터링(vpc3)이 운영(vpc1)과 베타(vpc2)에 접근하려면 vpc peering을 해야 한다.
	- 귀찮을 수도 있으니, 이점을 고려하여 다르게 둘지 같게 둘지를 판단해서 작업하자.
	- 물론 우테코는 하나의 vpc 안에서 작업한다.
- subnet의 고민? subnet을 분리할 지에 대한 고민?
=> 일단은 운영 vpc만 세팅을 하고 -> 다 하고 시간이 남으면 베타를 vpc 세팅을 똑같이 해보자. (해본 사람과 안 해본 사람이랑 페어하면서 서로 도우면서~)

### 리전
나라에 세워져 있는 AWS 큰 그림?
서울 리전을 사용할 것.

### 가용 영역
리전 안에 여러 개가 존재한다. 서울은 4개
데이터 센터라고 보면 된다. 실제로 데이터가 저장되는 곳은 실물로 있어야 한다.
기본 서브넷에 가용 영역이 주어져 있다.

aws 데이터 센터가 아마 a-b, c-d가 같은 데이터 센터에 있을 거라서 a, c 이런 식으로 만드는 게 국룰이라고 한다. (추가로 알아보자)

### vpc 워크플로

- 오리가 줌에서 보여주신 사진

![[vpc-workflow.png]]

### 요약
- vpc 세팅
	- 가용 영역은 2개를 사용한다. (a, c)
	- a, c가 서로 다른 데이터 센터에 위치할 듯 (검색해보기)
- subnet 세팅 (가용 영역 - a: public1 + private1 + private 2 / 가용 영역 - b: public1 + private1 + private 2)
	- private 서브넷 개수?
- rt 세팅
- IGW 세팅
- NAT 세팅 (일단 NAT가 뭔지부터 알아보자)
	- aws 에서 제공해주는 것 말고 NAT 인스턴스를 하나를 만드는 것 고려. vpc에서 인스턴스 하나 만들어서 해보기.
	- 너무 빡세면 ㅌㅌ
	- private을 다 막을 건데 private 인스턴스들이 java를 다운 받아야 하는데 막혀있어서 다운을 못한다. 그래서 NAT가 필요하다.
- ec2 세팅 (안 해도 된다)

++ '초보자를 위한 AWS 웹구축' 참고해 보기~

**다음 공유 시간: 13일까지. 운영 vpc 세팅 완료 목표 !!**